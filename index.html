<!doctype html>
<html lang="zh-CN">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>任务确认</title>
<body>
  <h2>请确认完成</h2>
  <p>点击下方按钮即可回传完成状态；可填写备注。</p>

  <textarea id="remark" rows="3" placeholder="例如：已完成，见截图…"></textarea><br/>
  <button id="done">完成并提交</button>
  <div id="tip"></div>

  <script>
    // 从 URL 取参数
    const qs = new URLSearchParams(location.search);
    const sid     = qs.get('sid') || '';
    const unionid = qs.get('unionid') || '';
    const dueTime = qs.get('dueTime') || '';

    const tip = document.getElementById('tip');
    const btn = document.getElementById('done');

    btn.onclick = async () => {
      const remark = document.getElementById('remark').value || '';
      btn.disabled = true;
      tip.innerHTML = '';

      try {
        const r = await fetch('/.netlify/functions/feedback', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          // 关键：把当前页链接也传给函数，便于回推“查看详情”
          body: JSON.stringify({ sid, unionid, dueTime, re
